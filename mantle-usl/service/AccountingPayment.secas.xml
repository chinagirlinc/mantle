<?xml version="1.0" encoding="UTF-8"?>
<!--
This is free and unencumbered software released into the public domain.
For specific language governing permissions and limitations refer to
the LICENSE.md file or http://unlicense.org
-->
<secas xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-eca-1.5.xsd">
    <!-- Authorize Payment when Order Placed -->
    <seca service="update#mantle.order.OrderHeader" when="post-service" run-on-error="false">
        <condition><expression>statusChanged &amp;&amp; statusId == 'OrderPlaced'</expression></condition>
        <actions><service-call name="mantle.account.PaymentServices.authorize#OrderPayments" in-map="context"/></actions>
    </seca>
    <!-- Capture Payment when Invoice Finalized (specifically payment received, ie Payment applied for incoming payments -->
    <seca service="update#mantle.account.invoice.Invoice" when="post-service" run-on-error="false">
        <!-- when status goes to InvoicePmtRecvd Payments are applied to Invoice and ready to be captured -->
        <condition><expression>statusChanged &amp;&amp; statusId == 'InvoicePmtRecvd'</expression></condition>
        <actions><service-call name="mantle.account.PaymentServices.capture#InvoicePayments" in-map="context"/></actions>
    </seca>
</secas>
